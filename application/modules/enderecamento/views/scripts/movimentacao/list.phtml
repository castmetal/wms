<?php if (isset($this->enderecoPicking)) : ?>
<p>
    Endereço de picking: <?php echo $this->enderecoPicking; ?>
</p>
<?php endif;
$total = 0;
?>

<?php foreach($this->endsPulmao as $produtosAgrupados) : ?>

    <table class="gTable ">
        <caption>Estoque do produto</caption>
        <tbody>
        <tr class ="gTTitle">
            <td>Código Produto</td>
            <td>Grade</td>
            <td>Descrição</td>
            <td>Picking</td>
            <td>Pulmão</td>
            <td>Dt. Entrada</td>
            <td>Unitizador</td>
            <td>Qtde</td>
        </tr>
        <tr>
            <td><?php echo $produtosAgrupados[0]['codProduto'] ?></td>
            <td><?php echo $produtosAgrupados[0]['grade'] ?></td>
            <td><?php echo $produtosAgrupados[0]['produto'] ?></td>
            <td><?php echo $this->enderecoPicking; ?></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <?php
        foreach($produtosAgrupados as $end) : ?>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td><?php echo $end['descricao'] ?></td>
            <td><?php echo $end['dtPrimeiraEntrada']->format('d/m/Y H:i:s') ?></td>
            <td><?php echo $end['unitizador'] ?></td>
            <td style="text-align:right"><?php echo $end['qtd']; $total = $total+$end['qtd'] ?></td>
        </tbody>
        <?php endforeach ?>
        <tr>
            <td colspan="8" style="text-align:right">Total:<?php echo $total ?></td>
        </tr>
    </table>

    <?php
    unset($total);
endforeach; ?>